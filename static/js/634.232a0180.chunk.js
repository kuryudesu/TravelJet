"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[634],{634:(e,a,s)=>{s.r(a),s.d(a,{default:()=>c});var t=s(555),r=s(43),l=s(305),n=s(184),i=s(810),o=s(579);const c=()=>{const[e,a]=(0,r.useState)(null),[s,c]=(0,r.useState)({username:"",email:""}),[d,m]=(0,r.useState)({newPassword:"",confirmPassword:""}),[u,p]=(0,r.useState)(!0),[x,f]=(0,r.useState)({type:"",text:""}),[h,v]=(0,r.useState)({type:"",text:""}),[g,w]=(0,r.useState)({type:"",text:""}),[j,y]=(0,r.useState)(null),[N,b]=(0,r.useState)(null),P=(0,r.useRef)(null);(0,r.useEffect)(()=>{(async()=>{try{const{data:e}=await(0,l.VM)();a(e),c({username:e.username,email:e.email})}catch(e){console.error("API failed, falling back to localStorage",e);const s=localStorage.getItem("user");if(s){const e=JSON.parse(s);a(e),c({username:e.username,email:e.email})}}finally{p(!1)}})()},[]);const S=e=>c((0,t.A)((0,t.A)({},s),{},{[e.target.name]:e.target.value})),C=e=>m((0,t.A)((0,t.A)({},d),{},{[e.target.name]:e.target.value}));if(u&&!e)return(0,o.jsx)(i.A,{});return(0,o.jsxs)("div",{className:"profile-page",children:[(0,o.jsxs)("header",{className:"profile-header",children:[(0,o.jsxs)("div",{className:"avatar-uploader",onClick:()=>P.current.click(),children:[(()=>{if(N)return(0,o.jsx)("img",{src:N,alt:"Preview",className:"profile-avatar-large"});if(e&&e.avatar_url){const a="".concat("http://192.168.0.170:5000").concat(e.avatar_url,"?_=").concat((new Date).getTime());return(0,o.jsx)("img",{src:a,alt:e.username,className:"profile-avatar-large"})}return(0,o.jsx)(n.NBi,{className:"profile-avatar-large"})})(),(0,o.jsxs)("div",{className:"avatar-overlay",children:[(0,o.jsx)(n.p5B,{}),(0,o.jsx)("span",{children:"Change"})]})]}),(0,o.jsx)("input",{type:"file",ref:P,onChange:e=>{const a=e.target.files[0];if(a){y(a);const e=URL.createObjectURL(a);b(e)}},style:{display:"none"},accept:"image/*"}),h.text&&(0,o.jsx)("p",{className:"avatar-message ".concat(h.type),children:h.text}),(0,o.jsxs)("div",{className:"profile-header-info",children:[(0,o.jsx)("h1",{children:null===e||void 0===e?void 0:e.username}),(0,o.jsx)("p",{children:null===e||void 0===e?void 0:e.email}),N&&(0,o.jsx)("button",{onClick:async()=>{if(!j)return;const s=new FormData;s.append("avatar",j),p(!0);try{const{data:r}=await(0,l.F4)(s),n=(0,t.A)((0,t.A)({},e),{},{avatar_url:r.avatarUrl});a(n),localStorage.setItem("user",JSON.stringify(n)),b(null),v({type:"success",text:"Avatar updated!"}),setTimeout(()=>{window.location.reload()},1e3)}catch(i){var r,n;v({type:"error",text:(null===(r=i.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.message)||"Upload failed."})}finally{p(!1)}},className:"submit-button small-btn",disabled:u,children:u?"Uploading...":"Upload Avatar"})]})]}),(0,o.jsxs)("main",{className:"profile-content",children:[(0,o.jsxs)("div",{className:"profile-card",children:[(0,o.jsx)("h2",{children:"Personal Information"}),(0,o.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),p(!0),f({type:"",text:""});try{const{data:e}=await(0,l.eg)(s);a(e.user),localStorage.setItem("user",JSON.stringify(e.user)),f({type:"success",text:e.message}),setTimeout(()=>{f("")},1e3)}catch(n){var t,r;f({type:"error",text:(null===(t=n.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||"Update failed."}),setTimeout(()=>{f("")},1e3)}finally{p(!1)}},children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"username",children:"Username"}),(0,o.jsx)("input",{type:"text",id:"username",name:"username",value:s.username,onChange:S})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"email",children:"Email Address"}),(0,o.jsx)("input",{type:"email",id:"email",name:"email",value:s.email,onChange:S})]}),(0,o.jsx)("button",{type:"submit",className:"submit-button",disabled:u,children:u?"Saving...":"Save Changes"}),x.text&&(0,o.jsx)("p",{className:"message ".concat(x.type),children:x.text})]})]}),(0,o.jsxs)("div",{className:"profile-card",children:[(0,o.jsx)("h2",{children:"Password & Security"}),(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),d.newPassword===d.confirmPassword){p(!0),w({type:"",text:""});try{const{data:e}=await(0,l.eg)({password:d.newPassword});w({type:"success",text:e.message}),m({newPassword:"",confirmPassword:""}),setTimeout(()=>{w("")},1e3)}catch(t){var a,s;w({type:"error",text:(null===(a=t.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||"Password update failed."}),setTimeout(()=>{w("")},1e3)}finally{p(!1)}}else w({type:"error",text:"Passwords do not match."})},children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"newPassword",children:"New Password"}),(0,o.jsx)("input",{type:"password",id:"newPassword",name:"newPassword",value:d.newPassword,onChange:C})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"confirmPassword",children:"Confirm New Password"}),(0,o.jsx)("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:d.confirmPassword,onChange:C})]}),(0,o.jsx)("button",{type:"submit",className:"submit-button",disabled:u,children:u?"Updating...":"Update Password"}),g.text&&(0,o.jsx)("p",{className:"message ".concat(g.type),children:g.text})]})]})]})]})}}}]);
//# sourceMappingURL=634.232a0180.chunk.js.map